# ground-filter
![image](https://github.com/den250400/ground-filter/assets/36325448/526e7d88-fa2c-4293-933b-1f6ab717f667)

![image](https://github.com/den250400/ground-filter/assets/36325448/1097db74-7eb7-403e-8ec0-84d5ae58c61f)


Проект содержит в себе функционал для автоматического удаления поверхности земли (кругов земли) с лидарного облака точек. Кроме этого, в проекте есть средство визуализации и чтения облаков точек в .pcap формате.

## Инструкция по сборке и запуску
Установка зависимостей
```bash
sudo apt-get install libyaml-cpp-dev libpcl-dev
```

Сборка проекта (перед этим необходимо склонировать этот репозиторий)
```bash
cd ground-filter
cmake .
make -j$(nproc)
```

Перед запуском в папку lidar_data необходимо перенести .pcap-файл с записью облака точек.
```bash
./ground_filter -pcapFile "./lidar_data/2022-06-10-15-29-36_Velodyne-VLP-32C-Data.pcap" -calibrationFile "./lidar_data/VLP-32c.xml" -configFile "./config.yaml"
```

## Метод фильтрации
Все праметры фильтра находятся в `config.yaml`, путь к которому необходимо указать при запуске в аргументе командной строки `-configFile`. Фильтрация реализуется в 3 этапа:
1. Из исходного облака точек удаляются все точки, вектор нормали которых отличается от оси Z более чем на 5 градусов (параметр `normal_max_degrees`). Вектор нормали вычисляется по 30 ближайшим соседям данной точки. Таким образом, получается промежуточное облако точек, в котором находится много точек из плоскости земли и некоторое количество шумов-outlier'ов.
2. В промежуточном облаке точек происходит RANSAC-сегментация по модели горизонтальной плоскости (параметр `eps_angle` регулирует максимальное отклонение плоскости от горизонтальной). В результате сегментации получаются коэффициенты плоскости, которая приближенно описывает поверхность земли.
3. Из исходного облака точек удаляются все точки, находящиеся ближе 0.2 метров (параметр `dist_thresh`) к плоскости, вычисленной в пункте 2.
